# POPPON í”„ë¡œì íŠ¸ STATUS

## í”„ë¡œì íŠ¸ ê°œìš”
- **ì œí’ˆëª…**: POPPON (K-RetailMeNot)
- **ê¸°íšì„œ ë²„ì „**: v1.2.1
- **í•œì¤„ ì •ì˜**: í•œêµ­ì˜ ëª¨ë“  í• ì¸/ì¿ í°/í”„ë¡œëª¨ì…˜ì„ í•œ ê³³ì— ëª¨ì•„, ê²€ìƒ‰Â·í•„í„°Â·ì¹´í…Œê³ ë¦¬Â·ìº˜ë¦°ë”Â·íë ˆì´ì…˜ìœ¼ë¡œ íƒìƒ‰ â†’ ì €ì¥/êµ¬ë…/ì•Œë¦¼ìœ¼ë¡œ DB ì¶•ì  â†’ TargetUP-AI CRM-Outside ê³ ë‹¨ê°€ íƒ€ê²Ÿë§ˆì¼€íŒ…ìœ¼ë¡œ ìˆ˜ìµí™”í•˜ëŠ” ë”œ í”Œë«í¼
- **MVP ìš°ì„ ìˆœìœ„**: A(ì˜¨ë¼ì¸ ì¿ í°/í”„ë¡œëª¨ì…˜ ì½”ë“œ) â†’ B(ì•±ì¿ í°/ë§í¬í˜•) â†’ C(ì˜¤í”„ë¼ì¸ ì´ë²¤íŠ¸)
- **í•µì‹¬ ë°©í–¥**: í• ì¸ì •ë³´ë¥¼ ë³´ê¸° ì‰½ê²Œ ëª¨ì•„ì„œ DB ì¶•ì  â†’ ìˆ˜ìµí™” (RetailMeNot ì½”ë“œë³µì‚¬/ìºì‹œë°± ëª¨ë¸ê³¼ ë‹¤ë¦„)

### í”„ë¡œì íŠ¸ êµ¬ì¡° (2ê°œ ë¶„ë¦¬)
| í”„ë¡œì íŠ¸ | ê²½ë¡œ | ìš©ë„ | ë°°í¬ |
|---------|------|------|------|
| **poppon** (ë©”ì¸) | `C:\projects\poppon` | ì‚¬ìš©ì ì›¹ (ë”œ íƒìƒ‰/ì €ì¥/ì¸ì¦) | `https://poppon.vercel.app` âœ… |
| **poppon-admin** (ì–´ë“œë¯¼) | `C:\projects\poppon-admin` | ê´€ë¦¬ì (ë”œCRUD/í¬ë¡¤ëŸ¬/Cron) | `https://poppon-admin.vercel.app` âœ… |

- **ë„ë©”ì¸**: `poppon.kr` (ê°€ë¹„ì•„, DNS ì„¤ì • í•„ìš”)
- **GitHub (ë©”ì¸)**: `https://github.com/hoyun5295-ctrl/poppon` (private)
- **GitHub (ì–´ë“œë¯¼)**: `https://github.com/hoyun5295-ctrl/poppon-admin` (private) âœ…

---

## âš ï¸ ê°œë°œ ì›ì¹™
> **ì ˆëŒ€ ì›ì¹™**: ì‹œí‚¤ê¸° ì „ì— ì½”ë“œ/íŒŒì¼ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤.
> ë°˜ë“œì‹œ **ê¸°ì¡´ íŒŒì¼ íŒŒì•… â†’ ì„¤ê³„ ì˜ë…¼ â†’ í•©ì˜ í›„ êµ¬í˜„** ìˆœì„œ.
> ê¸°ì¡´ ì½”ë“œ ë§ê°€ëœ¨ë¦¬ì§€ ì•Šë„ë¡ í˜„ì¬ êµ¬ì¡°ë¶€í„° í™•ì¸í•œë‹¤.

---

## í•µì‹¬ ì‚¬ìš©ì íë¦„ (Top 5)
1. í™ˆ â†’ ê²€ìƒ‰/ì¹´í…Œê³ ë¦¬ íƒìƒ‰ â†’ ë”œ ìƒì„¸(ëª¨ë‹¬) â†’ ì½”ë“œë³µì‚¬/ì‚¬ì´íŠ¸ì´ë™
2. ë”œ ìƒì„¸ â†’ "ì €ì¥/ì•Œë¦¼" â†’ ê°€ì… ë°”í…€ì‹œíŠ¸ â†’ SNS ë¡œê·¸ì¸ â†’ ì €ì¥ ì™„ë£Œ
3. ì¹´í…Œê³ ë¦¬ í—ˆë¸Œ â†’ ë§ˆê°ì„ë°•/ì´ë²ˆì£¼ íƒìƒ‰ â†’ íŠ¸ë Œë”© ë”œ ì†Œë¹„
4. ë¸Œëœë“œê´€ â†’ êµ¬ë… â†’ ì‹ ê·œ ë”œ ì•Œë¦¼ ìˆ˜ì‹ 
5. ìœ ì € ì œë³´(ë§í¬ ì œì¶œ) â†’ ìë™ íŒŒì‹± â†’ ìš´ì˜ì ìŠ¹ì¸ â†’ ì¸ë²¤í† ë¦¬ í™•ì¥

---

## ê¸°ìˆ  ìŠ¤íƒ
| ì˜ì—­ | ê¸°ìˆ  | ë¹„ê³  |
|------|------|------|
| Frontend + Backend | **Next.js 15 (App Router)** | SSR/SSG, API Routes |
| Database + Auth | **Supabase (PostgreSQL)** | RLS, OAuth (ì¹´ì¹´ì˜¤/ë„¤ì´ë²„/ì• í”Œ) |
| ìŠ¤íƒ€ì¼ë§ | **Tailwind CSS + shadcn/ui** | Pretendard |
| ìƒíƒœê´€ë¦¬ | **Zustand** | ê²½ëŸ‰ |
| ë°°í¬ | **Vercel Pro Ã—2** | Git push ìë™ ë°°í¬, ì„œìš¸(icn1) |
| ê²€ìƒ‰ | **PostgreSQL í’€í…ìŠ¤íŠ¸ (pg_trgm)** | ì´ˆê¸° 1ë§Œê±´ ì¶©ë¶„ |
| AI í¬ë¡¤ëŸ¬ | **Puppeteer + Claude Haiku** | ì»¤ë„¥í„° íƒ€ì…ë³„ (ì–´ë“œë¯¼ ì•±) |
| ë³¸ì¸ì¸ì¦ | **KMC** (ì›” 55,000ì› ê¸°ì¡´ ê³„ì•½) | ì—°ë™ ëŒ€ê¸° |

---

## ğŸš¨ ìƒˆ ì±„íŒ… ì‹œì‘ ì‹œ í™•ì¸

### SQL ì²´í¬ (ë¬¸ì œ ìˆì„ ë•Œë§Œ ì‹¤í–‰)
```sql
-- ë”œ ìƒíƒœë³„ í˜„í™©
SELECT status, COUNT(*) FROM deals GROUP BY status ORDER BY count DESC;

-- ì¹´í…Œê³ ë¦¬ë³„ ë¨¸ì²œíŠ¸/ë”œ í˜„í™©
SELECT c.name, c.slug,
  COUNT(DISTINCT m.id) as merchants,
  COUNT(DISTINCT d.id) as active_deals
FROM categories c
LEFT JOIN merchants m ON c.id = ANY(m.category_ids)
LEFT JOIN deals d ON d.merchant_id = m.id AND d.status = 'active'
WHERE c.depth = 0 AND c.is_active = true
GROUP BY c.id, c.name, c.slug
ORDER BY active_deals DESC;

-- ì»¤ë„¥í„° í˜„í™© (íƒ€ì…ë³„)
SELECT connector_type, status, COUNT(*) FROM crawl_connectors GROUP BY connector_type, status ORDER BY connector_type;

-- íšŒì› í…Œì´ë¸” í™•ì¸
SELECT COUNT(*) FROM profiles;
SELECT COUNT(*) FROM saved_deals;
SELECT COUNT(*) FROM followed_merchants;
```

---

## ğŸ“ ì°¸ì¡° íŒŒì¼ ëª©ë¡

### ğŸ”µ poppon (ë©”ì¸ ì•±)

#### ì»´í¬ë„ŒíŠ¸ / UI
| íŒŒì¼ | ê²½ë¡œ |
|------|------|
| DealCard.tsx | `src/components/deal/DealCard.tsx` |
| DealShelf.tsx | `src/components/deal/DealShelf.tsx` |
| DealGrid.tsx | `src/components/deal/DealGrid.tsx` |
| DealDetail.tsx | `src/components/deal/DealDetail.tsx` |
| DealModal.tsx | `src/components/deal/DealModal.tsx` |
| CopyCodeButton.tsx | `src/components/deal/CopyCodeButton.tsx` |
| DealDetailClient.tsx | `src/components/deal/DealDetailClient.tsx` |
| TopNav.tsx | `src/components/layout/TopNav.tsx` |
| Footer.tsx | `src/components/layout/Footer.tsx` |
| SourceProtection.tsx | `src/components/layout/SourceProtection.tsx` |
| TopProgressBar.tsx | `src/components/layout/TopProgressBar.tsx` |
| Toast.tsx | `src/components/common/Toast.tsx` |
| AuthSheet.tsx | `src/components/auth/AuthSheet.tsx` |
| MobileFilterSheet.tsx | `src/components/search/MobileFilterSheet.tsx` |
| SearchBar.tsx | `src/components/search/SearchBar.tsx` |
| SearchFilters.tsx | `src/components/search/SearchFilters.tsx` |
| SearchInput.tsx | `src/components/search/SearchInput.tsx` |
| CategoryGrid.tsx | `src/components/category/CategoryGrid.tsx` |
| SubCategoryChips.tsx | `src/components/category/SubCategoryChips.tsx` |
| CategoryTabBar.tsx | `src/components/category/CategoryTabBar.tsx` |
| CategoryIcon.tsx | `src/components/category/CategoryIcon.tsx` |
| MerchantDealTabs.tsx | `src/components/merchant/MerchantDealTabs.tsx` |
| Pagination.tsx | `src/components/common/Pagination.tsx` |
| SortDropdown.tsx | `src/components/common/SortDropdown.tsx` |

#### í˜ì´ì§€
| íŒŒì¼ | ê²½ë¡œ |
|------|------|
| ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ | `src/app/layout.tsx` (AuthProvider + TopProgressBar + Toast ë˜í•‘) |
| ê¸€ë¡œë²Œ CSS | `src/app/globals.css` (fade-in + toast ì• ë‹ˆë©”ì´ì…˜) |
| ë¯¸ë“¤ì›¨ì–´ | `src/middleware.ts` |
| í™ˆ | `src/app/page.tsx` |
| í™ˆ ë¡œë”© | `src/app/loading.tsx` |
| ê²€ìƒ‰ | `src/app/search/page.tsx` |
| ê²€ìƒ‰ ë¡œë”© | `src/app/search/loading.tsx` |
| ì¹´í…Œê³ ë¦¬ | `src/app/c/[categorySlug]/page.tsx` |
| ì¹´í…Œê³ ë¦¬ ë¡œë”© | `src/app/c/[categorySlug]/loading.tsx` |
| ë¸Œëœë“œê´€ | `src/app/m/[merchantSlug]/page.tsx` |
| ë¸Œëœë“œê´€ ë¡œë”© | `src/app/m/[merchantSlug]/loading.tsx` |
| ë”œ ìƒì„¸ (ëª¨ë‹¬) | `src/app/@modal/(.)d/[slug]/page.tsx` |
| ë”œ ìƒì„¸ (í’€í˜ì´ì§€) | `src/app/d/[slug]/page.tsx` |
| ì œë³´ | `src/app/submit/page.tsx` |
| ë§ˆì´í˜ì´ì§€ | `src/app/me/page.tsx` |
| ë§ˆì´ ë¡œë”© | `src/app/me/loading.tsx` |
| ë¡œê·¸ì¸ | `src/app/auth/page.tsx` (ë°”í…€ì‹œíŠ¸ ì—°ë™) |
| OAuth ì½œë°± | `src/app/auth/callback/route.ts` |

#### ë°ì´í„° / íƒ€ì… / ìœ í‹¸ / ì¸ì¦
| íŒŒì¼ | ê²½ë¡œ |
|------|------|
| database.ts (íƒ€ì…) | `src/types/database.ts` |
| index.ts (re-export) | `src/types/index.ts` |
| deals.ts (ë°ì´í„°) | `src/lib/deals.ts` |
| tracking.ts (í–‰ë™ì¶”ì ) | `src/lib/tracking.ts` |
| format.ts (ìœ í‹¸) | `src/lib/utils/format.ts` |
| constants.ts | `src/lib/constants.ts` |
| AuthProvider.tsx | `src/lib/auth/AuthProvider.tsx` |
| Supabase ì„œë²„ | `src/lib/supabase/server.ts` |
| Supabase ë¸Œë¼ìš°ì € | `src/lib/supabase/client.ts` (ì‹±ê¸€í†¤) |

#### API (ë©”ì¸ ì•±)
| íŒŒì¼ | ê²½ë¡œ |
|------|------|
| ì œë³´ API | `src/app/api/submit/route.ts` |
| í–‰ë™ì¶”ì  API | `src/app/api/actions/route.ts` |
| í´ë¦­ íŠ¸ë˜í‚¹ | `src/app/out/[dealId]/route.ts` |
| ë”œ ì €ì¥ API | `src/app/api/me/saved-deals/route.ts` |
| ë¸Œëœë“œ êµ¬ë… API | `src/app/api/me/follows/merchants/route.ts` |
| ê³„ì • íƒˆí‡´ API | `src/app/api/me/delete-account/route.ts` |
| ê²€ìƒ‰ ë¡œê·¸ API | `src/app/api/actions/search/route.ts` |
| ë¡œê·¸ì•„ì›ƒ API | `src/app/api/auth/signout/route.ts` |
| ë„¤ì´ë²„ OAuth ì‹œì‘ | `src/app/api/auth/naver/route.ts` |
| ë„¤ì´ë²„ OAuth ì½œë°± | `src/app/auth/callback/naver/route.ts` |

### ğŸ”´ poppon-admin (ì–´ë“œë¯¼ ì•±)

#### ì»´í¬ë„ŒíŠ¸
| íŒŒì¼ | ê²½ë¡œ |
|------|------|
| MerchantForm.tsx | `src/components/admin/MerchantForm.tsx` âœ… v4 (ì»¤ë„¥í„° ìë™ìƒì„±) |

#### í˜ì´ì§€
| íŒŒì¼ | ê²½ë¡œ |
|------|------|
| ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ | `src/app/layout.tsx` |
| ë¯¸ë“¤ì›¨ì–´ | `src/middleware.ts` (ë¹„ë°€ë²ˆí˜¸ ë³´í˜¸) |
| ë¡œê·¸ì¸ | `src/app/login/page.tsx` |
| ëŒ€ì‹œë³´ë“œ | `src/app/(dashboard)/page.tsx` |
| ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ | `src/app/(dashboard)/layout.tsx` |
| ë”œ ëª©ë¡/ìƒì„±/ìˆ˜ì • | `src/app/(dashboard)/deals/` |
| ë¨¸ì²œíŠ¸ ëª©ë¡/ìƒì„±/ìˆ˜ì • | `src/app/(dashboard)/merchants/` |
| íšŒì› ëª©ë¡ | `src/app/(dashboard)/members/page.tsx` |
| íšŒì› ìƒì„¸ | `src/app/(dashboard)/members/[id]/page.tsx` |
| í¬ë¡¤ ëª¨ë‹ˆí„°ë§ | `src/app/(dashboard)/crawls/page.tsx` âœ… v4 (íƒ€ì… í•„í„°) |
| í¬ë¡¤ ì´ë ¥ | `src/app/(dashboard)/crawl-history/page.tsx` |

#### API (ì–´ë“œë¯¼ ì•±)
| íŒŒì¼ | ê²½ë¡œ |
|------|------|
| ì–´ë“œë¯¼ ì¸ì¦ | `src/app/api/auth/route.ts` |
| ë”œ CRUD | `src/app/api/deals/route.ts` + `[id]/route.ts` âœ… FK ëª…ì‹œ |
| ë¨¸ì²œíŠ¸ CRUD | `src/app/api/merchants/route.ts` + `[id]/route.ts` âœ… v4 (ì»¤ë„¥í„° ìë™ìƒì„±) |
| ëŒ€ì‹œë³´ë“œ ê²½ëŸ‰ | `src/app/api/dashboard/route.ts` âœ… active/expired/pending ë¶„ë¦¬ |
| íšŒì› ëª©ë¡ | `src/app/api/members/route.ts` (N+1 ì œê±°) |
| íšŒì› ìƒì„¸ | `src/app/api/members/[id]/route.ts` |
| AI í¬ë¡¤ (ë°°ì¹˜/ë‹¨ì¼) | `src/app/api/ai-crawl/route.ts` + `[connectorId]/route.ts` âœ… v4 (íƒ€ì… ì‹œìŠ¤í…œ) |
| Cron í¬ë¡¤ | `src/app/api/cron/crawl/route.ts` (3-batch, single ì œì™¸) âœ… v4 |
| Cron ë§Œë£Œ | `src/app/api/cron/expire/route.ts` |
| í¬ë¡¤ ì´ë ¥ API | `src/app/api/crawl-history/route.ts` |

#### í¬ë¡¤ëŸ¬ / ìŠ¤í¬ë¦½íŠ¸ (ì–´ë“œë¯¼ì—ë§Œ ì¡´ì¬)
| íŒŒì¼ | ê²½ë¡œ |
|------|------|
| vercel.json | ë£¨íŠ¸ â€” Cron ìŠ¤ì¼€ì¤„ (3-batch + expire) |
| AI í¬ë¡¤ ì—”ì§„ (v4) | `src/lib/crawl/ai-engine.ts` âœ… íƒ€ì…ë³„ í”„ë¡¬í”„íŠ¸ |
| ë”œ ì €ì¥ (v2.1) | `src/lib/crawl/save-deals.ts` âœ… tokens_used ì €ì¥ |
| í¬ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ | `scripts/test-ai-crawl.ts` |
| ì´ë²¤íŠ¸ í˜ì´ì§€ íƒì§€ | `scripts/detect-event-pages.ts` |
| ë¡œê³  ìˆ˜ì§‘ v2/v3.1 | `scripts/fetch-merchant-logos.ts` / `fetch-merchant-logos-v3.ts` |
| êµ¬ê¸€ ì´ë¯¸ì§€ ë¡œê³  | `scripts/fetch-logos-google.ts` |
| OG ì´ë¯¸ì§€ ìˆ˜ì§‘ | `scripts/fetch-og-images.ts` |

#### ë°ì´í„° íŒŒì¼
| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `poppon_brands_filtered.csv` | ë¸Œëœë“œ 494ê°œ (ì›ë³¸) |
| `crawl-targets-final.csv` | ìµœì¢… í¬ë¡¤ë§ ëŒ€ìƒ 187ê°œ |
| `poppon-brand-master.csv` | 6ê°œ ì¹´í…Œê³ ë¦¬ 230ê°œ ë¸Œëœë“œ ë§ˆìŠ¤í„° |

---

## ë¼ìš°íŒ… êµ¬ì¡°

### ë©”ì¸ ì•±
```
src/app/
â”œâ”€â”€ layout.tsx               â€” AuthProvider + TopProgressBar + AuthSheet ë˜í•‘
â”œâ”€â”€ loading.tsx              â€” í™ˆ ìŠ¤ì¼ˆë ˆí†¤
â”œâ”€â”€ @modal/(.)d/[slug]/      â€” ì¸í„°ì…‰íŒ… ëª¨ë‹¬
â”œâ”€â”€ d/[slug]/                â€” SEO í’€ í˜ì´ì§€
â”œâ”€â”€ m/[merchantSlug]/        â€” ë¸Œëœë“œê´€ + loading.tsx
â”œâ”€â”€ c/[categorySlug]/        â€” ì¹´í…Œê³ ë¦¬ í—ˆë¸Œ + loading.tsx
â”œâ”€â”€ search/                  â€” ê²€ìƒ‰ ê²°ê³¼ + loading.tsx
â”œâ”€â”€ submit/                  â€” ìœ ì € ì œë³´
â”œâ”€â”€ me/                      â€” ë§ˆì´í˜ì´ì§€ + loading.tsx
â”œâ”€â”€ auth/                    â€” ë¡œê·¸ì¸ + callback/ (ì¹´ì¹´ì˜¤) + callback/naver/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ submit/, actions/, actions/search/
â”‚   â”œâ”€â”€ auth/signout/, auth/naver/
â”‚   â””â”€â”€ me/saved-deals/, me/follows/merchants/, me/delete-account/
â””â”€â”€ out/[dealId]/            â€” í´ë¦­ íŠ¸ë˜í‚¹
```

### ì–´ë“œë¯¼ ì•±
```
src/app/
â”œâ”€â”€ login/                   â€” ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸
â”œâ”€â”€ (dashboard)/
â”‚   â”œâ”€â”€ layout.tsx           â€” ì‚¬ì´ë“œë°”
â”‚   â”œâ”€â”€ page.tsx             â€” ëŒ€ì‹œë³´ë“œ
â”‚   â”œâ”€â”€ deals/, merchants/   â€” CRUD
â”‚   â”œâ”€â”€ members/             â€” íšŒì› ê´€ë¦¬ (ëª©ë¡ + [id] ìƒì„¸)
â”‚   â”œâ”€â”€ crawls/              â€” í¬ë¡¤ ëª¨ë‹ˆí„°ë§ (íƒ€ì… í•„í„°)
â”‚   â””â”€â”€ crawl-history/       â€” í¬ë¡¤ ì´ë ¥
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ auth/, deals/, merchants/, dashboard/
â”‚   â”œâ”€â”€ members/ + [id]/     â€” íšŒì› API
â”‚   â”œâ”€â”€ ai-crawl/ + [connectorId]/
â”‚   â”œâ”€â”€ crawl-history/
â”‚   â””â”€â”€ cron/crawl/, cron/expire/
```

### ë¯¸ë“¤ì›¨ì–´ ë³´í˜¸
- **ë©”ì¸**: `/brand/*` â†’ ë¡œê·¸ì¸ í•„ìˆ˜
- **ì–´ë“œë¯¼**: ì „ì²´ â†’ ADMIN_SECRET ì¿ í‚¤ í•„ìˆ˜ (login ì œì™¸)

---

## API êµ¬ì¡° ìš”ì•½

### ë©”ì¸ â€” Public
`GET /deals` (ëª©ë¡/ê²€ìƒ‰), `GET /deals/:id`, `GET /categories`, `GET /merchants`, `POST /api/submit`

### ë©”ì¸ â€” Member (ë¡œê·¸ì¸)
`GET /auth/callback` (OAuth), `GET /api/auth/signout` (ì„œë²„ ë¡œê·¸ì•„ì›ƒ), `GET|POST|DELETE /api/me/saved-deals`, `GET|POST|DELETE /api/me/follows/merchants`, `DELETE /api/me/delete-account` (soft delete), `POST /api/actions/search`, `POST /deals/:id/actions` (view/click_out/copy_code/save/share)

### ì–´ë“œë¯¼
`POST /api/auth`, CRUD: `/api/deals`, `/api/merchants` (ì»¤ë„¥í„° ìë™ìƒì„±), `GET /api/dashboard` (ê²½ëŸ‰ count), `GET|PATCH /api/members` + `GET /api/members/:id`, `GET|POST /api/ai-crawl`, `GET /api/crawl-history`, `GET /api/cron/crawl` (3-batch, single ì œì™¸), `GET /api/cron/expire`

### íŠ¸ë˜í‚¹
`GET /out/:dealId` â€” ì•„ì›ƒë°”ìš´ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (í´ë¦­ë¡œê·¸ + 302)

---

## ë”œ íƒ€ì… / íƒœê·¸ ì²´ê³„

| íƒ€ì… | ì„¤ëª… | CTA |
|------|------|-----|
| A1 | ì¿ í°/í”„ë¡œëª¨ì…˜ ì½”ë“œí˜• | CopyCodeButton + GoToSource |
| A2 | ê°€ê²©ë”œ/í•«ë”œ (ìµœì €ê°€/íŠ¹ê°€) | GoToSource (ì œíœ´ë§í¬) |
| B | ì•±ì¿ í°/ë§í¬í˜• | GetCouponButton + GoToSource |
| C | ì˜¤í”„ë¼ì¸ ì´ë²¤íŠ¸ | StoreInfoPanel + GoToSource |

- **í˜œíƒ (benefit_tags)**: percent_off, amount_off, bogo, free_shipping, gift_with_purchase, bundle_deal, clearance, member_only, new_user, app_only, limited_time
- **ì±„ë„**: online_only, offline_only, hybrid
- **ê¸´ê¸‰**: ending_soon_24h, ending_soon_3d, new_today, updated_today

---

## ì¹´í…Œê³ ë¦¬ (6ê°œ í™œì„±)
| name | slug | ë¹„ê³  |
|------|------|------|
| íŒ¨ì…˜ | fashion | âœ… active |
| ë·°í‹° | beauty | âœ… active |
| ì‹í’ˆ/ë°°ë‹¬ | food | âœ… active |
| ìƒí™œ/ë¦¬ë¹™ | living | âœ… active (ë””ì§€í„¸/ê°€ì „ í¡ìˆ˜) |
| ì—¬í–‰/ë ˆì € | travel | âœ… active |
| ë¬¸í™”/ì½˜í…ì¸  | culture | âœ… active |

ë¹„í™œì„± 6ê°œ: ë””ì§€í„¸/ê°€ì „(â†’ìƒí™œ í¡ìˆ˜), ê±´ê°•/í‚¤ì¦ˆ/ë°˜ë ¤ë™ë¬¼(ë³¼ë¥¨ ë¶€ì¡±), ìë™ì°¨/ê¸ˆìœµ(ë¶€ì í•©)

---

## DB ìŠ¤í‚¤ë§ˆ

### ë°ì´í„° í˜„í™© (2/17 ì•¼ê°„ ê¸°ì¤€)
| í•­ëª© | ìˆ˜ì¹˜ |
|------|------|
| ë¸Œëœë“œ (merchants) | 339ê°œ (ì „ì› ë¡œê³ +brand_color) |
| ë”œ (deals) | 1,064 ì „ì²´ (active 871 / expired 193 / hidden 0) |
| ì»¤ë„¥í„° (crawl_connectors) | 256 active / 171 disabled / 0 error |
| ì»¤ë„¥í„° íƒ€ì… | list 413 / naver_brand 1 / single 0 |
| ì¹´í…Œê³ ë¦¬ (depth 0) | 6ê°œ active / 6ê°œ ë¹„í™œì„± |

### deals í…Œì´ë¸” (ì£¼ìš” ì»¬ëŸ¼)
```
id, merchant_id(FK), category_id(FK), subcategory_id, title, description,
deal_type(A1/A2/B/C), status(pending/active/hidden/expired), channel,
benefit_tags(text[]), benefit_summary, coupon_code, discount_value/type,
price, original_price, discount_rate, conditions(jsonb),
starts_at, ends_at, is_evergreen,
source_type(crawl/brand/user_submit/affiliate/admin), source_url, landing_url, affiliate_url,
thumbnail_url, og_image_url, quality_score, trending_score,
view_count, click_out_count, save_count, feedback_work/fail_count,
slug, meta_title, meta_description, created_at, updated_at, expired_at
```

### merchants í…Œì´ë¸” (~339ê°œ)
```
id, name, slug, logo_url, brand_color(#hex), description, official_url,
category_ids(uuid[]), is_verified, follower_count, active_deal_count,
created_at, updated_at
```

### categories í…Œì´ë¸”
```
id, parent_id(ì…€í”„ì¡°ì¸), name, slug, description, icon,
sort_order, is_active, deal_count, depth(0=ëŒ€/1=ì¤‘/2=ì†Œ), created_at
```

### profiles í…Œì´ë¸”
```
id(FKâ†’auth.users), phone(nullable), name, nickname, avatar_url,
gender, birth_date(varchar), ci, di,
interest_categories(uuid[], DEFAULT '{}'), marketing_agreed(boolean, DEFAULT false),
marketing_agreed_at, marketing_channel(text[]),
provider(DEFAULT 'email'), linked_providers(text[]),
role(user/admin/super_admin), status(active/withdrawn/banned),
withdrawn_at, withdraw_reason, last_login_at, created_at, updated_at
```

âš ï¸ **ì½”ë“œâ†”DB ì»¬ëŸ¼ëª… ë§¤í•‘** (âœ… ì „ìˆ˜ ìˆ˜ì • ì™„ë£Œ 2/17)
| ì½”ë“œ ê¸°ì¡´ ëª…ì¹­ | ì‹¤ì œ DB ì»¬ëŸ¼ëª… |
|---|---|
| `interested_categories` | `interest_categories` |
| `marketing_opt_in` | `marketing_agreed` |

### ê¸°íƒ€ í…Œì´ë¸”
- **saved_deals**: id, user_id, deal_id, created_at â€” UNIQUE(user_id, deal_id)
- **followed_merchants**: id, user_id, merchant_id, created_at â€” UNIQUE(user_id, merchant_id)
- **crawl_connectors**: id, name, merchant_id, source_url, config, status, fail_count, last_run_at, content_hash(MD5), hash_updated_at, **connector_type**(list/single/naver_brand, DEFAULT 'list') âœ… v4
- **crawl_runs**: id, connector_id, status(running/success/partial/failed), new/updated/expired_count, error_message, started_at, completed_at, tokens_used(2/17 ì¶”ê°€)
- **deal_actions**: id, deal_id, user_id(nullable), session_id(ppn_sid), action_type, metadata(jsonb), created_at
- **search_logs**: id, user_id(nullable), session_id, query, category_slug, result_count, created_at
- **outbound_clicks**: deal_id(FKâ†’deals.id) â€” hidden ë”œ ì‚­ì œ ì‹œ FK ì œì•½ ì£¼ì˜

### ì¡°ì¸ ê´€ê³„
```
deals.merchant_id â†’ merchants.id
deals.category_id â†’ categories.id (FK: deals_category_id_fkey)
deals.subcategory_id â†’ categories.id (FK: deals_subcategory_id_fkey)
profiles.id â†’ auth.users.id
saved_deals â†’ auth.users + deals
followed_merchants â†’ auth.users + merchants
outbound_clicks.deal_id â†’ deals.id (FK: outbound_clicks_deal_id_fkey)
```
âš ï¸ Supabase ì¡°ì¸ ì‹œ FK ëª…ì‹œ í•„ìˆ˜: `categories!deals_category_id_fkey (name)`
âš ï¸ deals ì‚­ì œ ì‹œ outbound_clicks, deal_actions, saved_deals FK ë¨¼ì € ì‚­ì œ í•„ìš”

### RLS ì •ì±…
- deals: SELECT status='active'|'expired', ALL: admin/super_admin
- merchants/categories: SELECT ì „ì²´
- profiles: SELECT/UPDATE auth.uid()=id
- saved_deals/followed_merchants: ALL auth.uid()=user_id
- submissions: INSERT true, SELECT own

---

## íšŒì›ê°€ì…/ì¸ì¦ ì‹œìŠ¤í…œ

### ì•„í‚¤í…ì²˜
```
[ì´ë©”ì¼ ê°€ì…] AuthSheet 6ë‹¨ê³„ â†’ Supabase Auth â†’ profiles íŠ¸ë¦¬ê±° â†’ ë³¸ì¸ì¸ì¦(placeholder) â†’ ê´€ì‹¬ì¹´í…Œê³ ë¦¬ â†’ ë§ˆì¼€íŒ…ë™ì˜
[ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸] signInWithOAuth â†’ ì¹´ì¹´ì˜¤ ë™ì˜ â†’ Supabase ì½œë°± â†’ ì‹ ê·œ? â†’ /?onboarding=sns â†’ AuthSheet(categories)
[íƒˆí‡´] ë§ˆì´í˜ì´ì§€ â†’ soft delete (status='withdrawn') â†’ 30ì¼ í›„ ì™„ì „ ì‚­ì œ
[ë¡œê·¸ì•„ì›ƒ] <a href="/api/auth/signout"> â†’ sb- ì¿ í‚¤ ì‚­ì œ + 302 â†’ sessionStorage í† ìŠ¤íŠ¸
```

### êµ¬í˜„ í˜„í™©
- âœ… DB 6í…Œì´ë¸” + RLS + íŠ¸ë¦¬ê±°, AuthProvider + AuthSheet, ì¹´ì¹´ì˜¤ OAuth, SNS ì˜¨ë³´ë”©
- âœ… ì„œë²„ ì‚¬ì´ë“œ ë¡œê·¸ì•„ì›ƒ, Toast ì‹œìŠ¤í…œ, TOKEN_REFRESHED ë¬´í•œë£¨í”„ ë°©ì§€
- âœ… ë„¤ì´ë²„ OAuth (ìˆ˜ë™ í”Œë¡œìš° â€” admin.createUser+generateLink+verifyOtp)
- â¬œ ì• í”Œ OAuth (ì•± ì¶œì‹œ í›„), KMC ë³¸ì¸ì¸ì¦, ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡

### í™˜ê²½ë³€ìˆ˜

#### ë©”ì¸ ì•± (.env.local)
```
NEXT_PUBLIC_SUPABASE_URL=...
NEXT_PUBLIC_SUPABASE_ANON_KEY=sb_publishable_...
SUPABASE_SERVICE_ROLE_KEY=sb_secret_...
NAVER_CLIENT_ID=...
NAVER_CLIENT_SECRET=...
```

#### ì¹´ì¹´ì˜¤ OAuth (Supabase Providerì— ì„¤ì •)
```
REST API Key: 83c8e501803f831f075f7c955d91a000
ì•± ë„ë©”ì¸: https://poppon.vercel.app
Redirect URI: https://beniaypzlnygtoqmbvnx.supabase.co/auth/v1/callback
ë™ì˜í•­ëª©: ë‹‰ë„¤ì„(í•„ìˆ˜), í”„ë¡œí•„ì‚¬ì§„/ì´ë©”ì¼(ì„ íƒ)
```

#### ì–´ë“œë¯¼ ì•± (.env.local)
```
NEXT_PUBLIC_SUPABASE_URL=... (ë™ì¼)
NEXT_PUBLIC_SUPABASE_ANON_KEY=sb_publishable_... (ë™ì¼)
SUPABASE_SERVICE_ROLE_KEY=sb_secret_... (ë™ì¼)
ADMIN_SECRET=... (2/16 ë³€ê²½)
ANTHROPIC_API_KEY=sk-ant-api03-... (2/16 ì¬ë°œê¸‰)
CRON_SECRET=...
NEXT_PUBLIC_MAIN_URL=https://poppon.kr
```

---

## AI í¬ë¡¤ëŸ¬ v4 (ì»¤ë„¥í„° íƒ€ì… ì‹œìŠ¤í…œ)

### ì•„í‚¤í…ì²˜
```
ì»¤ë„¥í„° URL â†’ Puppeteer (ì´ë¯¸ì§€ ì°¨ë‹¨, 15s) â†’ MD5 í•´ì‹œ ë¹„êµ
  â†’ ë³€ê²½ ì—†ìŒ â†’ ìŠ¤í‚µ | ë³€ê²½ ìˆìŒ â†’ Claude Haiku íŒŒì‹± â†’ save-deals v2.1 (URL+title ì¤‘ë³µì²´í¬) â†’ hash ì €ì¥
  â†’ single íƒ€ì…: í•´ì‹œ ìŠ¤í‚µ, ì„±ê³µ í›„ ìë™ disabled
```

### ì»¤ë„¥í„° íƒ€ì… ì²´ê³„ (v4 ì‹ ê·œ)
| íƒ€ì… | ì„¤ëª… | Cron | ì„±ê³µ í›„ | í•´ì‹œì²´í¬ | í”„ë¡¬í”„íŠ¸ |
|------|------|------|--------|---------|---------|
| `list` | ì´ë²¤íŠ¸ ëª©ë¡ í˜ì´ì§€ | âœ… ë§¤ì¼ | active ìœ ì§€ | âœ… | ì—¬ëŸ¬ ë”œ ì¶”ì¶œ |
| `single` | ê°œë³„ ì´ë²¤íŠ¸ URL | âŒ ì œì™¸ | **auto disabled** | âŒ (1íšŒì„±) | ë”œ 1ê°œë§Œ ë¶„ì„ |
| `naver_brand` | ë„¤ì´ë²„ ë¸Œëœë“œìŠ¤í† ì–´ | âœ… ë§¤ì¼ | active ìœ ì§€ | âœ… | ì—¬ëŸ¬ ë”œ ì¶”ì¶œ (í–¥í›„ ì „ìš© íŒŒì„œ) |

### ë¸Œëœë“œ ë“±ë¡ â†’ ì»¤ë„¥í„° ìë™ìƒì„±
```
MerchantFormì—ì„œ ì´ë²¤íŠ¸ URL ì…ë ¥
  â†’ brand.naver.com ê°ì§€ â†’ naver_brand ìë™ì„ íƒ
  â†’ ê·¸ ì™¸ â†’ list/single ë¼ë””ì˜¤ ì„ íƒ
  â†’ merchants API POST â†’ ë¨¸ì²œíŠ¸ ìƒì„± + crawl_connectors INSERT
  â†’ ì¤‘ë³µ URL ì²´í¬ (ì´ë¯¸ ìˆìœ¼ë©´ ìŠ¤í‚µ)
```

### ë¹„ìš©/ì„±ê³¼
- ì „ëµ ë³€ì²œ: static_html(ì‹¤íŒ¨) â†’ API ì§ì ‘(ë¶€ë¶„ì„±ê³µ) â†’ **Puppeteer+AI** âœ… ìµœì¢…
- ë¹„ìš©: í˜„ì¬ ~150ê°œ ì²« í¬ë¡¤ ~$3, ì´í›„ ì›” ~$15 (í•´ì‹œ ìŠ¤í‚µ)
- ë¡œê³ : v2(HTTP)+v3.1(Puppeteer)+êµ¬ê¸€ì´ë¯¸ì§€ ìˆ˜ì§‘, ìˆ˜ë™ 34ì¢… êµì²´ ì™„ë£Œ

---

## TargetUP-AI ì—°ë™ / ìš´ì˜ ì •ì±… / ë¶„ì„

- **TargetUP-AI**: phone_hash, marketing_opt_in, ê´€ì‹¬ì¹´í…Œê³ ë¦¬/ë¸Œëœë“œ, ìµœê·¼ í–‰ë™ ìš”ì•½ â†’ segments_daily ë°°ì¹˜ ë™ê¸°í™”
- **ìš´ì˜ ì •ì±…**: ì¶œì²˜ í•­ìƒ í‘œì‹œ, robots ì¡´ì¤‘, ì‹¤íŒ¨ 3íšŒâ†’ë¹„í™œì„±, ë§Œë£Œ ìë™ ì „í™˜, ê´‘ê³  ìŠ¤í°ì„œ ë¼ë²¨ í•„ìˆ˜
- **ë¶„ì„ ì´ë²¤íŠ¸**: deal_view/click_out/copy_code/save, merchant_follow, search_performed, signup_start/complete, marketing_opt_in

---

## ê°œë°œ Phase
- **Phase 0** âœ… ì™„ë£Œ: DB 18í…Œì´ë¸”+RLS, ì „ì²´ í˜ì´ì§€, ì–´ë“œë¯¼, AI í¬ë¡¤ëŸ¬ v3, Vercel ë°°í¬
- **Phase 1** âœ… ê±°ì˜ ì™„ë£Œ: í¬ë¡¤ëŸ¬ v4(íƒ€ì…ì‹œìŠ¤í…œ)+ë§Œë£Œ+ë””ìì¸+íšŒì›+ë¸Œëœë“œ í™•ì¥+ì–´ë“œë¯¼ ë¶„ë¦¬+ë”œ ì •ë¦¬
- **Phase 2** ë¯¸ì°©ìˆ˜: ë„ë©”ì¸ ì—°ê²° / ë§í¬í”„ë¼ì´ìŠ¤ ì œíœ´ / ë¸Œëœë“œ í¬í„¸ / ìŠ¤í°ì„œ ìŠ¬ë¡¯ / ì„±ê³¼ ì •ì‚°

---

## ğŸ–¥ï¸ ì¸í”„ë¼ ì„¤ê³„ (í™•ì • 2/17)
- **í˜„ì¬**: Vercel Pro ($20/ì›” Ã— 2) + Supabase Pro ($25/ì›”) = **$65/ì›” (ì•½ 9ë§Œì›)**
  - ë©”ì¸+ì–´ë“œë¯¼: Vercel (ì„œìš¸ icn1)
  - DB: Supabase Pro (200 ë™ì‹œì»¤ë„¥ì…˜, 8GB, ì¼ 7íšŒ ë°±ì—…, **ì„œìš¸ ap-northeast-2**)
- **í–¥í›„ ì´ê´€ íŠ¸ë¦¬ê±°**: Supabase ë¹„ìš© ì›” $100+ ë˜ëŠ” í¬ë¡¤ ìˆ˜ì²œ ê±´ ì‹œ ìì²´ ì„œë²„ ê²€í† 

---

## ë°°ì¹˜ ìŠ¤ì¼€ì¤„ (ì–´ë“œë¯¼ Vercel Cron)
- 23:00 KST (14:00 UTC): batch=1 (ì»¤ë„¥í„° 1/3, ~85ê°œ, **single ì œì™¸**)
- 23:20 KST (14:20 UTC): batch=2 (ì»¤ë„¥í„° 2/3, ~85ê°œ)
- 23:40 KST (14:40 UTC): batch=3 (ì»¤ë„¥í„° 3/3, ~84ê°œ)
- 23:50 KST (14:50 UTC): expire (ë§Œë£Œ ë”œ ìë™ ì²˜ë¦¬)
- **ì•ˆì „ì¥ì¹˜**: 250ì´ˆ íƒ€ì„ì•„ì›ƒ (Vercel 300ì´ˆ ì œí•œ ì „ ì¤‘ë‹¨)
- **v4 ë³€ê²½**: Cronì—ì„œ `connector_type IN ('list', 'naver_brand')` â€” single ìë™ ì œì™¸

---

## ğŸ”´ ë¯¸í•´ê²° / ì§„í–‰ ì˜ˆì •

### ë¯¸í•´ê²°
- âš ï¸ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í›„ ì˜¨ë³´ë”© í…ŒìŠ¤íŠ¸ í•„ìš”
- âš ï¸ ì¼ë¶€ êµ¬ê¸€ ì´ë¯¸ì§€ ë¡œê³  í’ˆì§ˆ ë‚®ìŒ (34ê°œ êµì²´ ì™„ë£Œ, ë‚˜ë¨¸ì§€ ì§„í–‰ ì¤‘)

### ì¦‰ì‹œ (Phase 1 ë§ˆë¬´ë¦¬)
- **ë„ë©”ì¸**: ê°€ë¹„ì•„ DNS ì„¤ì • (A: @â†’76.76.21.21, CNAME: wwwâ†’cname.vercel-dns.com, adminâ†’ë³„ë„)
- **í¬ë¡¤ í…ŒìŠ¤íŠ¸**: v4 ì—”ì§„ ë‹¨ì¼ ì»¤ë„¥í„° ì‹¤í–‰ í™•ì¸
- **ì–´ë“œë¯¼**: ë”œ ê´€ë¦¬ ìˆ˜ì • ë§í¬ ê²½ë¡œ í™•ì¸ (`/deals/${id}/edit`)

### ë‹¨ê¸° (Phase 2)
- **ë§í¬í”„ë¼ì´ìŠ¤**: ì œíœ´ API ì—°ë™ â†’ `source_type: 'affiliate'` + `affiliate_url` í•„ë“œ í™œìš©
- **íšŒì›**: ì• í”Œ OAuth, KMC ë³¸ì¸ì¸ì¦, ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡, ê²€ìƒ‰ trackSearch ì—°ë™
- **ì–´ë“œë¯¼**: íƒˆí‡´ 30ì¼ ìë™ ì‚­ì œ Cron
- **í¬ë¡¤ëŸ¬**: naver_brand ì „ìš© íŒŒì„œ (êµ¬ì¡° í†µì¼, API ë¹„ìš© 0ì› ê°€ëŠ¥)
- **í¬ë¡¤ëŸ¬**: single íƒ€ì… ì²˜ë¦¬ ë¡œì§ ê²€ì¦ + ìœ ì € ì œë³´(/submit) â†’ single ì»¤ë„¥í„° ìë™ ìƒì„±

### ì¤‘ê¸° (Phase 3)
- **ìˆ˜ìµí™”**: TargetUP-AI CRM ì—°ë™ (ê±´ë‹¹ 60~70ì› íƒ€ê²Ÿ ë§ˆì¼€íŒ…)
- **ì¸í”„ë¼**: Docker Compose (íŠ¸ë˜í”½ ì¦ê°€ ëŒ€ë¹„)
- **ë¸Œëœë“œ í¬í„¸**: ìŠ¤í°ì„œ ìŠ¬ë¡¯, ì„±ê³¼ ì •ì‚°

---

## ì£¼ì˜ì‚¬í•­ / íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
- í•œê¸€ slug â†’ decodeURIComponent í•„ìˆ˜
- Supabase ì¡°ì¸ FK ëª…ì‹œ í•„ìˆ˜: `categories!deals_category_id_fkey`
- ëª¨ë‹¬ ë‚´ë¶€ ë§í¬ â†’ `<a>` hard navigation
- categories.deal_count DB ê°’ 0 â†’ active ë”œ ì‹¤ì œ ì§‘ê³„ë¡œ ëŒ€ì²´
- ë³‘ë ¬ í¬ë¡¤ concurrency ê¸°ë³¸ 3 (ìµœëŒ€ 5)
- brand_color: **339ê°œ ì „ì› ì ìš© ì™„ë£Œ**
- ë”œ ì´ë¯¸ì§€: thumbnail_urlì€ DealCardì—ì„œ ì‚¬ìš© ì•ˆ í•¨ (ë¡œê³  ì¤‘ì‹¬ ë””ìì¸)
- Puppeteer waitForTimeout ì œê±°ë¨ â†’ `new Promise(r => setTimeout(r, ms))`
- Vercel ë¹Œë“œ: `.rpc()` â†’ `.then(() => {}, () => {})`, íƒ€ì… ì²´í¬ ì—„ê²©
- ë¡œê³  ìˆ˜ë™êµì²´: `public/logos/` + DB logo_url ë™ì‹œ ì—…ë°ì´íŠ¸ í•„ìš”
- CategoryGrid/CategoryTabBar: 'use client', CategoryIconì€ color propë§Œ
- **PowerShell**: Set-Content ì¸ì½”ë”© â†’ node ìŠ¤í¬ë¦½íŠ¸ ê¶Œì¥, [id] í´ë” â†’ `-LiteralPath` í•„ìˆ˜
- **ì–´ë“œë¯¼ tsconfig.json**: `"exclude": ["node_modules", "scripts"]`
- **Supabase API Keys**: ë ˆê±°ì‹œ Disabled â†’ sb_publishable_/sb_secret_ ì‚¬ìš©. ì–‘ìª½ .env.local + Vercel ëª¨ë‘ ì‹ ê·œ í‚¤
- **Supabase client.ts ì‹±ê¸€í†¤**: `createClient()` í•¨ìˆ˜ ì‚¬ìš© í•„ìˆ˜. `createBrowserClient()` ì§ì ‘ í˜¸ì¶œ ê¸ˆì§€
- **Vercel Function Region**: ë©”ì¸+ì–´ë“œë¯¼ ë‘˜ ë‹¤ ì„œìš¸(icn1) ì„¤ì • ì™„ë£Œ. ë¦¬ì „ ë³€ê²½ í›„ Redeploy í•„ìš”
- **DealDetailClient ìºì‹œ**: ë©”ëª¨ë¦¬(í´ë¼ì´ì–¸íŠ¸) í•œì •, ìƒˆë¡œê³ ì¹¨ ì‹œ ì´ˆê¸°í™”
- **AuthProvider TOKEN_REFRESHED**: fetchProfile ì ˆëŒ€ ê¸ˆì§€ â†’ ë¬´í•œë£¨í”„. `profileLoadedForRef`ë¡œ ë°©ì§€
- **ë¡œê·¸ì•„ì›ƒ**: ì„œë²„ ì‚¬ì´ë“œ API(`/api/auth/signout`) í•„ìˆ˜. `<a>` íƒœê·¸ ì‚¬ìš©
- **ì„¤ì • íƒ­ public ë°ì´í„°**: Supabase REST API ì§ì ‘ í˜¸ì¶œ (`fetch + apikey í—¤ë”`)
- **Toast ì‹œìŠ¤í…œ**: sessionStorage('poppon_pending_toast') â†’ layout mount ì‹œ í‘œì‹œ
- **Puppeteer ì„œë²„ë¦¬ìŠ¤**: `puppeteer-core` + `@sparticuz/chromium` í•„ìˆ˜
- **Vercel ë°°ì¹˜ í¬ë¡¤ íƒ€ì„ì•„ì›ƒ**: 3-batch ë¶„í•  + 250ì´ˆ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ í•´ê²°
- **ì¹´ì¹´ì˜¤ OAuth**: REST API Key `83c8e501803f831f075f7c955d91a000`, ë„ë©”ì¸ ë³€ê²½ ì‹œ ì¹´ì¹´ì˜¤ í¬í„¸ ë™ê¸°í™”
- **openAuthSheet íƒ€ì…**: `(initialStepOrEvent?: AuthSheetStep | unknown) => void`
- **profiles.phone**: UNIQUE í•´ì œë¨. KMC ì—°ë™ ì‹œ ì¬ì ìš© ê²€í† 
- **Cron 3-batch**: ì»¤ë„¥í„° ì´ë¦„ìˆœ ì •ë ¬ â†’ 3ë“±ë¶„, 250ì´ˆ ì´ˆê³¼ ì‹œ ìŠ¤í‚µ. **v4: single íƒ€ì… ìë™ ì œì™¸**
- **DealModal ìŠ¤í¬ë¡¤**: `position: fixed` + `top: -scrollY` íŒ¨í„´ í•„ìˆ˜
- **crawl_runs.tokens_used**: 2/17 ì¶”ê°€. save-deals.ts completeCrawlRunLogì—ì„œ ì €ì¥
- **ì–´ë“œë¯¼ Supabase íƒ€ì… ì¶”ë¡ **: Generated Types ì—†ì´ `let _supabase: any` + `createClient<any>()` ì‚¬ìš©. server.tsëŠ” ê¸°ì¡´ `createServerClient` ìœ ì§€
- **ì–´ë“œë¯¼ N+1 ì¿¼ë¦¬**: íšŒì› ëª©ë¡ ê°œë³„ `getUserById()` ê¸ˆì§€ â†’ `auth.admin.listUsers()` ë°°ì¹˜ í•„ìˆ˜
- **ë„¤ì´ë²„ OAuth**: ìˆ˜ë™ í”Œë¡œìš° `/api/auth/naver` + `/auth/callback/naver`. `updateUserById` ì‚¬ìš© í•„ìˆ˜ (updateUser ì•„ë‹˜). í™˜ê²½ë³€ìˆ˜ `NAVER_CLIENT_ID/SECRET` â€” popponë§Œ
- **ì–´ë“œë¯¼ ë”œ ëª©ë¡ 0ê°œ ë²„ê·¸**: `/api/deals` categories ì¡°ì¸ FK ë¯¸ëª…ì‹œ â†’ `categories!deals_category_id_fkey` í•„ìˆ˜ (2/17 ìˆ˜ì •)
- **ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œ marketing_opt_in**: ì‹¤ì œ ì»¬ëŸ¼ëª… `marketing_agreed`ë¡œ ìˆ˜ì • (2/17)
- **deals ì‚­ì œ ì‹œ FK**: outbound_clicks â†’ deal_actions â†’ saved_deals ìˆœì„œë¡œ ë¨¼ì € ì‚­ì œ í•„ìš”
- **hidden ë”œ ëŒ€ì •ë¦¬**: 931ê°œ ì¤‘ ê¸ˆìœµ ì œì™¸ 849ê°œ active ì „í™˜, ë‚˜ë¨¸ì§€ ì‚­ì œ (2/17). ìµœì¢… active 871ê°œ
- **ì»¤ë„¥í„° íƒ€ì… ì»¬ëŸ¼**: `crawl_connectors.connector_type` DEFAULT 'list'. ê¸°ì¡´ ì „ë¶€ list, naver URLì€ naver_brandë¡œ ìë™ ë¶„ë¥˜
- **single ì»¤ë„¥í„°**: í¬ë¡¤ ì„±ê³µ ì‹œ ìë™ `status: 'disabled'`. Cronì—ì„œ ì œì™¸. í•´ì‹œ ì²´í¬ ì•ˆ í•¨

---

## ì±„íŒ… íˆìŠ¤í† ë¦¬
| ì±„íŒ… | ë‚ ì§œ | ì£¼ìš” ë‚´ìš© |
|------|------|-----------|
| íŒí°-ì›¹ì‚¬ì´íŠ¸ê°œë°œì‹œì‘ | 2/14 | DB, ì–´ë“œë¯¼, í¬ë¡¤ëŸ¬ ê¸°ì´ˆ |
| íŒí°-í¬ë¡¤ë§ì—ëŒ€í•œê³ ë¯¼ | 2/14 | Puppeteer+AI ì „ëµ |
| íŒí°-í¬ë¡¤ë§ì™„ë£Œ | 2/14 | 1ì°¨ í¬ë¡¤ë§, 455ê°œ ë”œ |
| íŒí°-ìƒì„¸ ê°œë°œ í˜ì´ì§€ ë“± | 2/15 | í™ˆ, ë”œìƒì„¸, ë¡œê³  v2 |
| íŒí°-ë¸Œëœë“œê´€ ë“± ê¸°íƒ€ | 2/15 | ë¸Œëœë“œê´€/ê²€ìƒ‰/ì¹´í…Œê³ ë¦¬/Cron |
| íŒí°-ì¤‘ë³µì œê±° ë° ë¡œê³  | 2/15 | DealCard ë¦¬ë””ìì¸ |
| íŒí°-ìŠ¤í…Œì´í„°ìŠ¤ ì •ë¦¬ | 2/15 | STATUS.md ì •ë¦¬ |
| íŒí°-DealCard+ë¡œê³  | 2/15 | brand_color, DealCard v3 |
| íŒí°-DealCard v4+ë¡œê³ v4 | 2/16 | DealCard v4.2, ë¡œê³  v4 |
| íŒí°-STATUS+ë§Œë£Œ+ë²„ê·¸ | 2/16 | ë§Œë£Œ ìë™í™” |
| íŒí°-í´ë¦­íŠ¸ë˜í‚¹+ì–´ë“œë¯¼+ë°°í¬ | 2/16 | í´ë¦­íŠ¸ë˜í‚¹, ì–´ë“œë¯¼ ë³´í˜¸ |
| íŒí°-ëª¨ë°”ì¼ë°˜ì‘í˜•+í¬ë¡¤ëŸ¬+ë°°í¬ | 2/16 | ëª¨ë°”ì¼ 12íŒŒì¼, Vercel ë°°í¬ |
| íŒí°-í¬ë¡¤ë§ìµœì í™”+íšŒì›ì„¤ê³„+í–‰ë™ì¶”ì  | 2/16 | í¬ë¡¤ëŸ¬ v3, ì»¤ë„¥í„° ì •ë¦¬, deal_actions, íšŒì›ì„¤ê³„ |
| íŒí°-STATUSë³µì›+ë¡œê³ +ì¹´í…Œê³ ë¦¬ë¦¬ë””ìì¸ | 2/16 | STATUS ë³µì›, ë¡œê³  9ì¢…, ì¹´í…Œê³ ë¦¬ ë¦¬ë””ìì¸, Vercel Pro |
| íŒí°-ë””ìì¸ê°œì„ +ëª¨ë‹¬ì†ë„+ë§Œë£Œí•„í„° | 2/16 | í™ˆ ê²€ìƒ‰ì°½ ì œê±°, Lucide í†µì¼, ë”œ ëª¨ë‹¬ í´ë¼ì´ì–¸íŠ¸ fetch |
| íŒí°-ì¹´í…Œê³ ë¦¬êµ¬ì¡°ì¡°ì •+ë¨¸ì²œíŠ¸ëŒ€ì •ë¦¬ | 2/16 | ì¹´í…Œê³ ë¦¬ 12â†’6, ë¨¸ì²œíŠ¸ ë§¤í•‘, ì‹ ê·œ 75ê°œ, ë¸Œëœë“œ ë§ˆìŠ¤í„° 230ê°œ |
| íŒí°-ë¸Œëœë“œí™•ì¥+í’€í¬ë¡¤ | 2/16 | ì»¤ë„¥í„° 65ê°œ ë“±ë¡, ë¡œê³  75ê°œ, í’€í¬ë¡¤ 243ê°œ(173ë”œ/$1.41) |
| íŒí°-ì¹´í…Œê³ ë¦¬ì–¸ë”ë¼ì¸+ì†ŒìŠ¤ë³´í˜¸+ì»¤ë„¥í„°ì •ë¦¬ | 2/16 | ì–¸ë”ë¼ì¸ íƒ­ í†µì¼, ì†ŒìŠ¤ë³´í˜¸ ê°•í™”, ì»¤ë„¥í„° ëŒ€ì •ë¦¬(256 active) |
| íŒí°-ì¸ì¦ì‹œìŠ¤í…œ+ì–´ë“œë¯¼ë¶„ë¦¬ | 2/16 | íšŒì› DB 6í…Œì´ë¸”, AuthProvider+AuthSheet, ì–´ë“œë¯¼ ë¶„ë¦¬, ì–‘ìª½ ë¹Œë“œ |
| íŒí°-í‚¤ë¡œí…Œì´ì…˜+ì–´ë“œë¯¼ë°°í¬ | 2/16 | Supabase ì‹ ê·œ í‚¤, Anthropic ì¬ë°œê¸‰, ì–´ë“œë¯¼ GitHub+Vercel ë°°í¬ |
| íŒí°-íšŒì›ê°€ì…+í–‰ë™ì¶”ì +ì–´ë“œë¯¼íšŒì›ê´€ë¦¬ | 2/16 | AuthSheet 6ë‹¨ê³„, soft delete, tracking, ì–´ë“œë¯¼ íšŒì›ê´€ë¦¬ |
| íŒí°-ì„±ëŠ¥ìµœì í™”+UXë¶€ë“œëŸ¬ì›€ | 2/17 | ì‹±ê¸€í†¤, ë¦¬ì „ ì„œìš¸, ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜, ìºì‹œ, TopProgressBar, loading.tsx |
| íŒí°-ì¸ì¦UX+í† ìŠ¤íŠ¸+ë¡œê·¸ì•„ì›ƒìˆ˜ì • | 2/17 | Toast, ì´ë©”ì¼ ê¸°ì–µ, ë§ˆì´í˜ì´ì§€ ê´€ì‹¬ì¹´í…Œê³ ë¦¬/ì¶”ì²œë¸Œëœë“œ |
| íŒí°-ë¡œê·¸ì•„ì›ƒ+ë¬´í•œë£¨í”„ë””ë²„ê¹… | 2/17 | TOKEN_REFRESHED ì°¨ë‹¨, ì„œë²„ ë¡œê·¸ì•„ì›ƒ, REST API ì§ì ‘ í˜¸ì¶œ |
| íŒí°-ì¹´ì¹´ì˜¤OAuth+SNSì˜¨ë³´ë”© | 2/17 | ì¹´ì¹´ì˜¤ ì—°ë™, SNS ì˜¨ë³´ë”©, phone UNIQUE í•´ì œ, ì»¬ëŸ¼ëª… ë¶ˆì¼ì¹˜ ë°œê²¬ |
| íŒí°-ì»¬ëŸ¼ìˆ˜ì •+í¬ë¡¤ëŸ¬ì„œë²„ë¦¬ìŠ¤+ì¸í”„ë¼ë…¼ì˜ | 2/17 | ì»¬ëŸ¼ ì „ìˆ˜ ìˆ˜ì •, Vercel Puppeteer, ë°°ì¹˜ ìˆœì°¨ í˜¸ì¶œ, í’€í¬ë¡¤ ì‹¤í–‰ |
| íŒí°-ë„¤ì´ë²„OAuth+ì¸í”„ë¼í™•ì • | 2/17 | ì¸í”„ë¼ $65/ì›” í™•ì •, Supabase Pro, ë„¤ì´ë²„ OAuth ìˆ˜ë™ í”Œë¡œìš° |
| íŒí°-STATUS+ê²€ìƒ‰ê°œì„ +ë¡œê³ êµì²´ | 2/17 | ì„œë¸Œì¹´í”¼ ë™ì , í’€í¬ë¡¤ 256ê°œ(208ì„±ê³µ/$2.92), ë¡œê³  5ì¢…, ê²€ìƒ‰ ê°œì„  |
| íŒí°-ë¡œê³ êµì²´+í‘¸í„°+í™ˆê·¸ë¦¬ë“œ | 2/17 | ë¡œê³  34ì¢…, í‘¸í„° ì‚¬ì—…ì ì •ë³´, í™ˆ limit 48 |
| íŒí°-Cronìë™í™”+í¬ë¡¤ì´ë ¥ | 2/17 | 3-batch ë¶„í• , í¬ë¡¤ ì´ë ¥ í˜ì´ì§€+API, ëª¨ë‹¬ ìŠ¤í¬ë¡¤ ìˆ˜ì • |
| íŒí°-ì–´ë“œë¯¼ì†ë„ê°œì„ +íšŒì›ìƒì„¸+í˜ì´ì§• | 2/17 | ëŒ€ì‹œë³´ë“œ ê²½ëŸ‰API, íšŒì› N+1 ì œê±°, ë¸Œëœë“œ/í¬ë¡¤ 10ê°œ í˜ì´ì§•, ì–´ë“œë¯¼ ì„œìš¸ ì„¤ì • |
| **íŒí°-ë”œë²„ê·¸ìˆ˜ì •+ì»¤ë„¥í„°íƒ€ì…v4+ë”œì •ë¦¬** | **2/17** | **ë”œ ëª©ë¡ FK ìˆ˜ì •, ëŒ€ì‹œë³´ë“œ active/expired ë¶„ë¦¬, ì»¤ë„¥í„° íƒ€ì… ì‹œìŠ¤í…œ(list/single/naver_brand), hidden 931ê°œ ì •ë¦¬â†’active 871ê°œ, ë¸Œëœë“œ ë“±ë¡ ì»¤ë„¥í„° ìë™ìƒì„±** |

---

### ë”œ ë²„ê·¸ ìˆ˜ì • + ì»¤ë„¥í„° íƒ€ì… v4 + ë”œ ì •ë¦¬ (2/17 ì•¼ê°„)
- [x] ë”œ ëª©ë¡ 0ê°œ ë²„ê·¸ â€” `/api/deals` categories ì¡°ì¸ FK ëª…ì‹œ (`categories!deals_category_id_fkey`)
- [x] ëŒ€ì‹œë³´ë“œ ì§€í‘œ ê°œì„  â€” active/expired/pending ë¶„ë¦¬, `marketing_opt_in` â†’ `marketing_agreed` ìˆ˜ì •
- [x] ë”œ ê´€ë¦¬ ìˆ˜ì • ë§í¬ ê²½ë¡œ â€” `/admin/deals/${id}/edit` â†’ `/deals/${id}/edit`
- [x] pending 327ê°œ â†’ active ì „í™˜ + ë§Œë£Œ 57ê°œ â†’ expired + íŒŒì‹± ì˜¤ë¥˜ 10ê°œ â†’ hidden
- [x] ì»¤ë„¥í„° íƒ€ì… ì‹œìŠ¤í…œ v4 â€” `connector_type` ì»¬ëŸ¼ ì¶”ê°€ (list/single/naver_brand)
- [x] AI ì—”ì§„ v4 â€” single ì „ìš© í”„ë¡¬í”„íŠ¸, single í•´ì‹œ ìŠ¤í‚µ, single ì„±ê³µ í›„ auto disabled
- [x] Cron v4 â€” `.in('connector_type', ['list', 'naver_brand'])` single ìë™ ì œì™¸
- [x] ë¸Œëœë“œ ë“±ë¡ í¼ â€” ì´ë²¤íŠ¸ URL ì…ë ¥ â†’ ì»¤ë„¥í„° ìë™ ìƒì„± (naver ìë™ê°ì§€)
- [x] í¬ë¡¤ ëª¨ë‹ˆí„°ë§ â€” íƒ€ì… ì»¬ëŸ¼ + íƒ€ì…ë³„ í•„í„° ë“œë¡­ë‹¤ìš´
- [x] hidden 931ê°œ ëŒ€ì •ë¦¬ â€” ê¸ˆìœµ 7ë¸Œëœë“œ ì œì™¸ â†’ 849ê°œ active ì „í™˜ â†’ ë‚˜ë¨¸ì§€ ì‚­ì œ (FK ì œì•½ í•´ê²°)
- [x] ìµœì¢… ìƒíƒœ: active 871 / expired 193 / hidden 0 / ì „ì²´ 1,064

---

*ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2026-02-17 ì•¼ê°„ (ì»¤ë„¥í„° íƒ€ì… v4 + ë”œ ëŒ€ì •ë¦¬ + ë¸Œëœë“œ ë“±ë¡ ì»¤ë„¥í„° ìë™ìƒì„±)*
